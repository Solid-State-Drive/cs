# 5장. 컴퓨터 아키텍처와 운영체제

### 컴퓨터 아키텍처(Computer Architecture)

```tex
▫️ 소프트웨어와 하드웨어를 포함한 컴퓨터 시스템의 전체 설계 방식
```

### 멀티태스킹(Multitasking)

```tex
▫️ 여러 프로그램을 동시에 실행하는 기능 or 겉으로 보기에는 여러 프로그램이 동시에 실행되는 것처럼 보이게 하는 기능
```

### 운영체제(OS; Operating System)

```tex
▫️ 사용자의 하드웨어, 시스템 리소스를 제어하고 프로그램에 대한 일반적 서비스를 지원하는 시스템 소프트웨어
```

## 기본적인 구조 요소들

### 프로세서

```tex
▫️ 기본적인 명령어들을 처리하는 논리회로
```

+ 프로세서의 종류
  + CPU : 디바이스가 해야할 일을 총 관리하는 프로세서
  + 보조프로세서(Coprocessor) : CPU의 기능을 보조하는 프로세서
  + 마이크로프로세서(Micro Processor) : PC or 소형 디바이스에 장착된 프로세서
+ 프로세서의 구성 요소
  + 코어(Core) : 각종 연산을 담당하는 CPU의 핵심 연산 장치 → 코어가 1개면 싱글코어, 2개면 듀얼코어, 4개면 쿼드코어라고 하며, 코어 수가 많을수록 병렬 처리 효율이 늘어날 수 있습니다.
    + 제어 장치(Control Unit) : SW를 읽고 HW의 다른 부분으로 신호를 보냄
    + 연산 장치(ALU, Arithmetic Logic Unit) : 덧셈, 뺄셈 등 사칙 연산 + AND, OR와 같은 논리 연산을 담당
    + 레지스터
    + JTAG, 내부 버스, 캐시(Cache) 등

### 멀티 프로세서(multiprocessor)

```tex
▫️ 둘 이상의 중앙 처리 장치 (CPU)가있는 컴퓨터 시스템
```

+ 특징
  + 각각은 주변 장치뿐만 아니라 공통 기본 메모리를 공유

### 병렬 처리(Parallel Processing)

```tex
▫️ 여러 개의 프로세서를 통해 하나의 프로그램을 처리하는 것
```

+ 특징
  + 처리 부하를 분담하므로 인해 처리 속도의 향상

### 마이크로프로세서 vs 마이크로컨트롤러

+ 마이크로프로세서(MPU; Micro processor)

  ```tex
  ▫️ 프로세서 내부에 레지스터, 제어장치, 연산장치를 포함하여 연산에 특화된 기능을 갖는 장치
  ```

  + 마이크로 프로세서는 개별적으로는 연산 수행만 가능
  + ROM, RAM과 같은 저장장치, 입출력 포트 같은 출력장치 등의 주변 장치가 있어야 사용 가능

+ 마이크로컨트롤러(MCU; Micro controller) = 마이크로컴퓨터(Micro computer)

  ```tex
  ▫️ 마이크로프로세서와 이를 사용하기 위한 메모리, 입력장치 등의 필요한 기능이 함께 집적된 장치
  ```

  + 단독으로 사용이 가능

+ 마이크로프로세서(MPU) vs 마이크로컨트롤러(MCU)

  + 마이크로프로세서(MPU) → 저장장치, 출력장치와 함께 사용해야하는 연산목적의 CPU + 단독 사용 불가
  + 마이크로컨트롤러(MCU) → 저장장치와 출력장치가 내장된 단독 사용이 가능한 CPU + 단독 사용 가능

## 프로시저, 서브루틴, 함수

+ 함수, 프로시저, 서브루틴 → 코드를 재사용(reuse)하는 주요 수단

### **함수(Function)**

```tex
▫️ 반환값이 있는 함수, 결과를 도출 하는 것이 목적
```

### **프로시저(procedure)**

```tex
▫️ 함수와 서브루틴을 통칭
```

### **서브루틴(subroutine)**

```tex
▫️ 반환값이 없는 함수, 수행 그 자체가 목적
```

## 스택(Stack)

```tex
▫️ 마지막에 들어온 데이터가 가장 먼저 나가는 LIFO(Last In First Out) 구조를 가진 자료구조
```

+ 스택 오버플로(Stack Overflow) : 꽉 찬 스택에 데이터를 넣으려 할 때 발생
+ 스택 언더플로(Stack Underflow) : 비어 있는 스택에서 데이터를 꺼내려 할 때 발생
+ 스택 프레임(stack frame) : 스택 영역에 차례대로 저장되는 함수의 호출 정보
  + 스택 프레임 덕분에 함수의 호출이 모두 끝난 뒤에, 해당 함수가 호출되기 이전 상태로 되돌아갈 수 있음

### 재귀(Recursion)

```tex
▫️ 자기 자신을 호출하는 함수
```

### 트리(Tree)

```tex
▫️ 그래프의 일종으로, 여러 노드가 한 노드를 가리킬 수 없는 구조
```

+ 쿼드 트리(quadtree) : 각 노드에서 가지가 4개 뻗어나가는 트리
+ 탐색 알고리즘
  + 너비 우선 순회(BFS; Breadth-first search) : 트리를 조회할 때, 넓이를 기반하여 우선적으로 조회
  + 깊이 우선 순회(DFS; Depth-first search) : 트리를 조회할 때, 깊이를 기반하여 우선적으로 조회

## 인터럽트(Interrupt)

```tex
▫️ CPU가 특정 기능을 수행하는 도중에 급하게 다른 일을 처리하고자 할 때 사용할 수 있는 기능
```

+ 종류

  + 내부 인터럽트 - HW 고장, 실행할 수 없는 명령어, 명령어 실행 어류, 사용 권한 위배, …
  + 외부 인터럽트 - 타이머 인터럽트, 입출력 인터럽트

+ 인터럽트 처리과정

  <img src="https://user-images.githubusercontent.com/33214969/175761764-b2de776a-6606-4205-8833-ac3eef7d2a07.png" alt="5장 - 인터럽트 처리과정.png" width="70%;" />

  1. process A는 시스템콜(system call)을 통해 인터럽트를 발생시킴
  2. CPU는 현재 진행 중인 기계어 코드를 완료함
  3. 현재까지 수행중이었던 상태를 해당 process의 **PCB(Process Control Block)**에 저장함 (수행중이던 MEMORY주소, 레지스터 값, 하드웨어 상태 등...)
  4. PC(Program Counter, IP)에 다음에 실행할 명령의 주소를 저장함
  5. 인터럽트 벡터를 읽고 ISR 주소값을 얻어 **ISR(Interrupt Service Routine)**로 점프하여 루틴을 실행함
  6. 해당 코드를 실행함
  7. 해당 일을 다 처리하면, 대피시킨 레지스터를 복원함
  8. ISR의 끝에 IRET 명령어에 의해 인터럽트가 해제됨
  9. IRET 명령어가 실행되면, 대피시킨 PC 값을 복원하여 이전 실행 위치로 복원함

+ 인터럽트 관련 시간

  + 인터럽트 지연시간(Interrupt Latency) : 인터럽터가 비활성화 된 최대 시간 + ISR에서 최초 명령을 시작하는 시간
  + 인터럽트 응답시간(Interrupt Response) : 인터럽트 지연시간 + CPU 문맥(context)을 저장하는 시간
  + 인터럽트 복귀시간(Interrupt Recovery) : CPU가 문맥을 복구하는 시간 + 인터럽트로부터 복귀 명령을 수행하는 시간

## 상대 주소 지정

### 커널(Kernel)

```tex
▫️ 시스템에 존재하는 자원을 효율적으로 관리하는 자원 관리자
```

+ 역할
  + 보안
  + 자원 관리 - 한정된 시스템 자원을 효율적으로 관리하여 프로그램의 실행을 원활하게 함
  + 추상화
+ 종류
  + 단일형 커널(monolithic kernel) : 커널의 다양한 서비스 및 높은 수준의 하드웨어 추상화를 하나의 주소 공간으로 묶어 놓은 것
  + 마이크로 커널(micro kernel) : 하드웨어 추상화에 대한 간결한 작은 집합을 제공하고 더 많은 기능은 서버라 불리는 응용 SW를 통해 제공함
  + 혼합형 커널(hybrid kernel) : 성능 향상을 위해 추가적인 코드를 커널 공간에 넣은 점을 제외하면 순수 마이크로커널과 비슷함
  + 나노 커널(nano kernel) : 실질적으로 모든 서비스를 책임짐
  + 엑소 커널(exo kernel) : 낮은 수준의 HW 접근을 위한 최소한의 추상화를 제공함

### 시분할(Time Slicing) 시스템

```tex
▫️ 사용자 프로그램의 실행 시간을 조절하는 스케줄링 기법
```

+ 특징
  + 라운드 로빈(Round Robin)방식이라고도 함
  + 하나의 CPU는 같은 시점에서 여러 개의 작업을 동시에 수행할 수 없기 때문에, CPU의 전체 사용시간을 작은 작업 시간량으로 쪼개어 그 시간량 동안만 번갈아가면서 CPU를 할당하여 각 작업을 처리함
  + 다중프로그래밍 방식과 결합하여 모든 작업이 동시에 진행되는 것처럼 대화식 처리가 가능
  + 시스템의 전체 효율은 좋아지나 개인별 사용자 입장에서는 반응 속도가 느려질 수 있음
  + 각 작업에 대한 응답 시간을 최소한으로 줄이는 것을 목적으로 하며, 하드웨어를 보다 능률적으로 사용할 수 있음

### 명령어 주소 지정방식(Addressing mode)

```tex
▫️ 프로그램 수행 시 오퍼랜드(피연산자)를 지정하는 방법
```

+ 유효 주소 : 주소 지정방식에 의해 결정되는 오퍼랜드의 주소

  <img src="https://user-images.githubusercontent.com/33214969/175761763-fc7469f7-f69f-4597-96ac-e5c22f2797fc.png" alt="5장 - 유효주소.png" width="50%;" />

  + 연산코드 : 수행할 연산의 종류를 지정
  + 주소 지정방식 : 연산에 필요한 오퍼랜드의 주소를 알아내는데 사용
  + 오퍼랜드 : 연산의 대상이 되는 기억장치 주소 or 레지스터

+ 종류

  + 의미 주소 지정방식(Implied mode) : 주소 필드가 필요없는 방식
  + 즉시 주소 지정방식(Immediate mode) : 주소 필드에 실제 사용할 오퍼랜드(피연산자)를 지정
  + 직접 주소 지정방식(Direct-addressing mode) : 주소 필드에 오퍼랜드의 주소(=유효주소)를 직접 저장
  + 간접 주소 지정방식(Indirect-addressing mode) : 주소필드에 유효주소가 저장되어 있는 기억장치 주소를 저장
  + 레지스터 주소 지정방식(Register mode) : 주소필드에 오퍼랜드(피연산자)가 들어있는 레지스터를 저장하는 방식
  + 레지스터 간접 주소 지정방식(Register-indirect mode) : 주소필드에 오퍼랜드가 저장된 기억장치 주소값을 갖고 레지스터를 지정하는 방식
  + 상대 주소 지정방식(Relative addressing mode) : 유효주소를 계산하기 위해 특정 레지스터의 내용에 명령어 주소필드 값을 더하는 방식
    + 유효주소 = 명령어 오퍼랜드 + PC(Program counter)
    + 장점 - 적은 비트 수로 표현할 수 있기 때문에 간결한 명령어를 구성 가능함
  + 인덱스된 주소 지정방식(Indexed addressing mode) : 유효주소를 계산하기 위해 인덱스 레지스터의 내용에 명령어 주소필드 값을 더하는 방식
    + 유효주소 = 명령어 오퍼랜드 + 인덱스 레지스터

## 메모리 관리 장치(MMU; Memory Management Unit)

```tex
▫️ CPU가 메모리에 접근하는 것을 관리하는 컴퓨터 하드웨어
```

<img src="https://user-images.githubusercontent.com/33214969/175761768-e8af517c-b086-4c02-9476-07972ad37032.png" alt="5장 - MMU.png" width="50%;" />

+ 특징
  + CPU → 가상 메모리 주소를 다루고, 실제 해당 주소 접근 시 MMU 하드웨어 장치를 통해 물리 메모리에 접근함

### 페이징 시스템(Paging System)

```tex
▫️ 크기가 동일한 페이지 단위로 가상 주소 공간과 이에 매칭되는 물리 주소 공간을 관리
```

<img src="https://user-images.githubusercontent.com/33214969/175761767-bfd38421-1ce1-468d-b2cb-7241ff4500e2.png" alt="5장 - 페이징.png" width="50%;" />

+ 특징
  + 페이지 번호를 기반으로 가상 주소와 물리 주소의 매핑(mapping) 정보를 기록하고 사용함
+ 용어
  + 페이지 폴드(Page fault) : 요구하는 페이지가 존재하지 않는 경우
  + 프레임(Frame) : 물리 메모리를 일정한 크기로 나눈 블록
  + 페이지(Page) : 가상 메모리를 일정한 크기로 나눈 블록
  + 페이지 테이블(Page Table) : 프로세스의 각 페이지가 어느 프레임에 있는지 나타내는 표 → 프레임의 기준 주소를 갖고 있음

## 시스템 공간과 사용자 공간

+ OS에는 Dual-Mode(커널모드 + 유저모드)가 있음
+ mode bit가 현재 모드를 나타냄(0 → kernel mode / 1 → user mode)
+ 용도에 따라 2개 이상의 모드를 사용할 수도 있음 ⇒ Multimode operation

### 유저모드(User mode)

```tex
▫️ 사용자가 접근할 수 있는 영역을 제한적으로 두고, 프로그램의 자원에 함부로 침범하지 못하는 모드
```

### 커널모드(Kernel mode)

```tex
▫️ 특권 명령어(privileged instruction) 실행과 원하는 작업 수행을 위한 자원 접근을 가능하게 하는 모드
```

### 유저모드 ↔ 커널모드 전환

+ 유저모드 → 커널모드로 요청 : 프로세스가 유저모드에서 실행되다가 특별한 요청이 필요할 때 system call을 이용해 커널에 요청함
+ 커널모드 → 유저모드로 반환 : system call의 요청을 받은 커널이 그 요청에 대한 일을 하고 결과 값을 system call의 리턴 값으로 전해줌

## 메모리 계층과 성능

<img src="https://user-images.githubusercontent.com/33214969/175761760-ed806854-9714-4d6c-aae6-e93cf95a0ea8.png" alt="5장 - 메모리계층.png" width="50%;" />

+ 메모리를 필요에 따라 여러 종류로 나누어 둠 → CPU가 메모리에 더 빨리 접근 가능함

### 레지스터(Register)

```tex
▫️ CPU가 요청을 처리하는 데 필요한 데이터를 일시적으로 저장하는 장치
```

+ 특징
  + CPU 안에 레지스터가 존재함
  + 컴퓨터에서 4대 주요 기능(기억, 해석, 연산, 제어)를 관할하는 장치
  + 프로세서에 위치한 고속 메모리로, 프로세스가 바로 사용할 수 있는 데이터(소량의 데이터, 처리 중인 중간 결과 등)를 담고 있는 영역

### 캐시(Cache)

```tex
▫️ 데이터 or 값을 미리 복사해 놓는 임시 장소
```

+ 특징
  + 시스템의 효율성을 위해 사용함 → 캐시의 접근 시간에 비해 원래 데이터를 접근하는 시간이 오래 걸리는 경우, 값을 다시 계산하는 시간을 절약하고 싶은 경우, …
  + 속도가 빠른 장치와 느린 장치 사이에서 속도 차에 따른 병목 현상을 완화하기 위한 범용 메모리
+ 캐싱(Caching) : 캐시라는 좀 더 빠른 메모리 영역으로 데이터를 가져와서 접근하는 방식

### 메인메모리 (=주기억장치)

```tex
▫️ 컴퓨터에서 수치, 명령, 자료 등을 기억하는 컴퓨터 HW 장치
```

+ 구성

  1. RAM(Random Access Memory) : 휘발성 기억 장치

     + 컴퓨터가 빠른 액세스를 하기 위해 데이터를 단기간 저장하는 구성 요소
     + 사용자가 요청하는 프로그램/문서를 스토리지 디스크에서 메모리로 로드하여 각각의 정보에 액세스함
     + 전원 종료 시, 기억된 내용이 삭제됨

  2. ROM(Read Only Memory) : 고정 기억 장치

     + 컴퓨터에서 지시사항을 영구히 저장하는 비휘발성 메모리

     + 전원 종료 시, 기억된 내용을 유지

     + 변경 가능성이 희박한 기능/부품에 사용

       ex) SW - 초기 부팅 관련 부분 / HW - 프린터 작동에 관련하는 펌웨어 명령 등

### 하드 디스크 드라이브(HDD; Hard Disk Drive)

```tex
▫️ 비휘발성, 순차접근이 가능한 컴퓨터의 보조 기억 장치
```

+ 특징
  + 하드 디스크(Hard Disk), 하드 드라이브(Hard Drive), 고정 디스크(Fixed Drive)
  + 비휘발성 데이터 저장소 가운데 가장 대중적 + 용량 대비 가격이 가장 저렴함